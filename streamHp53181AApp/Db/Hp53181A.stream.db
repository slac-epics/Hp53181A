# Record Configuration 

# DTYP 
# field (DTYP, "stream")

# Format of INP / OUT link 
# field (INP, "@file protocol port address")
# field (OUT, "@file protocol port address")
#
# field (INP, "@file protocol(arg) port address")
# field (OUT, "@file protocol(arg1,arg2,arg3) port address")

# file  - Name of the protocol file. The file is searched in the /cfg directory of the IOC 
# protocol - Name of the protocol in the file 
# port - Name of the port as configured in the startup script 
# address - Address of the device for ports with addresses like GPIB. Optional. 
# Some protocol require arguments.
# In this case append arguments to the protocol name in parentheses without spaces: 

record(bo,"$(sys):$(dev)Disable") {
  field(DESC,"Disable Readback")
  field(ASG,"Internal")
  field(DOL,"1")
  field(ZNAM,"On")
  field(ONAM,"Off")
  field(OSV,"MAJOR")
}
record(seq,"$(sys):$(dev)SetSeq") {
  field(DESC,"Set Config")
  field(ASG,"Internal")
  field(PINI,"YES")
  field(DOL1,"1")
  field(LNK1,"$(sys):$(dev)Disable  PP")
  field(LNK2,"$(sys):$(dev)ConfigSetpt.PROC  PP")
  field(DLY3,"0.2")
  field(LNK3,"$(sys):$(dev)ArmStartSetpt.PROC  PP")
  field(DLY4,"0.2")
  field(LNK4,"$(sys):$(dev)ArmStopSetpt.PROC  PP")
  field(DLY5,"0.2")
  field(LNK5,"$(sys):$(dev)ArmTimerSetpt.PROC  PP")
  field(DLY6,"0.2")
  field(LNK6,"$(sys):$(dev)TrigContSetpt.PROC  PP")
  field(FLNK,"$(sys):$(dev)SetSeq2")
}

record(seq,"$(sys):$(dev)SetSeq2") {
  field(DESC,"Set Config")
  field(ASG,"Internal")
  field(DLY1,"0.2")
  field(LNK1,"$(sys):$(dev)Attn.PROC  PP")
  field(DLY2,"0.2")
  field(LNK2,"$(sys):$(dev)FiltState.PROC  PP")
  field(DLY3,"0.2")
  field(LNK3,"$(sys):$(dev)Coupling.PROC  PP")
  field(DLY4,"0.2")
  field(LNK4,"$(sys):$(dev)Imped.PROC  PP")
  field(DLY5,"0.2")
  field(LNK5,"$(sys):$(dev)Arm.PROC  PP")
  field(DLY6,"1")
  field(LNK6,"$(sys):$(dev)Disable  PP")
  field(LNK7,"$(sys):$(dev)ID.PROC  PP")
  field(DLY8,"0.2")
  field(LNK8,"$(sys):$(dev)Status.PROC  PP")
}

record(ai, "$(sys):$(dev)Hz") {
  field(DESC, "Frequency in Hz")
  field(DTYP, "stream")
  field(INP, "@Hp53181A.proto.db GET_CH_VAL bus2 3")    
  field(EGU, "Hz")
  field(PREC, "2")
  field(MDEL, "0.01")
  field(SCAN, "1 second")
  field(FLNK, "$(sys):$(dev)HzNo$(bnam)")
  field(SDIS,"$(sys):$(dev)Disable  NPP NMS")
}

record(calc, "$(sys):$(dev)HzNo$(bnam)") {
  field(DESC, "Freq in Hz - base")
  field(CALC, "A-B")
  field(INPA, "$(sys):$(dev)Hz NPP NMS")
  field(INPB, "$(bval)")
  field(EGU, "Hz")
  field(PREC, "2")
  field(MDEL, "0.01")
  field(FLNK, "$(sys):$(dev)")
}

record(calc, "$(sys):$(dev)") {
  field(DESC, "Frequency")
  field(CALC, "A/1000000.0")
  field(INPA, "$(sys):$(dev)Hz NPP MS")
  field(EGU, "MHz")
  field(PREC, "7")
  field(MDEL, "0.00000005")
  field(HSV, "MINOR")
  field(LSV, "MINOR")
  field(HHSV, "MAJOR")
  field(LLSV, "MAJOR")
  field(HOPR, "$(drvh)")
  field(LOPR, "$(drvl)")
  field(HIGH, "$(high)")
  field(LOW, "$(low)")
  field(HIHI, "$(hihi)")
  field(LOLO, "$(lolo)")
  field(FLNK, "$(sys):$(dev)Arm")
}

record(stringout,"$(sys):$(dev)Arm") {
  field(DESC,"Arm")
  field(ASG,"Internal")
  field(VAL,"INIT")
  field(DTYP, "stream")
  field(OUT, "@Hp53181A.proto.db SET_CH_VAL bus2 3")    
}

record(bo, "$(sys):$(dev)Attn") {
  field(DESC, "Freq Counter Inp Atten ")
  field(DTYP, "stream")
  field(DOL,"$(attn)")  
  field(OUT, "@Hp53181A.proto.db SET_INP_ATT($(attn)) bus2 3")    
}

record(bo, "$(sys):$(dev)FiltState") {
  field(DESC, "Freq Counter Filter Off/On")
  field(DTYP, "stream")   
  field(DOL,"$(filt)")
  field(OUT, "@Hp53181A.proto.db SET_INP_FILT($(filt)) bus2 3")      
}

record(bo, "$(sys):$(dev)Coupling") {
  field(DESC, "Freq Counter Inp Coupling")
  field(DTYP, "stream") 
  field(DOL,"$(coup)")
  field(OUT, "@Hp53181A.proto.db SET_INP_COUP($(coup)) bus2 3")        
}

record(bo, "$(sys):$(dev)Imped") {
  field(DESC, "Freq Counter Inp Impedance")
  field(DTYP, "stream") 
  field(DOL,"$(imped)")
  field(OUT, "@Hp53181A.proto.db SET_INP_IMP($(imped)) bus2 3")    
}

record(stringin, "$(sys):$(dev)ID") {
  field(DESC, "Freq Counter ID String")
  field(DTYP, "stream") 
  field(INP, "@Hp53181A.proto.db GET_IDN bus2 3")   
  field(FLNK, "$(sys):$(dev)Option")
  field(SDIS,"$(sys):$(dev)Disable  NPP NMS")
}

record(stringin, "$(sys):$(dev)Option") {
  field(DESC, "Freq Counter Option String")
  field(DTYP, "stream")
  field(INP, "@Hp53181A.proto.db GET_OPT bus2 3")  
  field(SDIS,"$(sys):$(dev)Disable  NPP NMS")
}

record(stringin, "$(sys):$(dev)Status") {
  field(DESC, "Freq Counter Status")
  field(DTYP, "stream")
  field(INP, "@Hp53181A.proto.db GET_SYST_ERR bus2 3")
  field(SDIS,"$(sys):$(dev)Disable  NPP NMS")
}
